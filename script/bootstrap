#!/bin/bash
set -e

echo "Setting up your environment..."


if test ! $(which redis-server)
then
  echo "  x You need to install Redis. If you use Homebrew, you can run:"
  echo "    brew install redis"
  exit
fi


if test ! $(which memcached)
then
  echo " x You need to install Memcached:"
  echo "   brew install memcached"
  exit
fi


if test ! $(which bundle)
then
  echo "  x You need to install Bundler:"
  echo "    gem install bundler"
  exit
fi


bundle install

echo "copying the example files config files..."
cp ./config/application.example.yml ./config/application.yml
cp ./config/database.example.yml ./config/database.yml

echo "creating the database..."
bundle exec rake db:create

echo "migrating the database..."
bundle exec rake db:migrate

echo "seeding the database..."
bundle exec rake db:seed

echo "starting redis, sidekiq, and memcached servers..."
foreman start

echo "Done!"
